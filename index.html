<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kalkulator + World Currency Index</title>
<style>
* { box-sizing: border-box; font-family: Arial, sans-serif; }
body {
  background: #0f172a;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  color: white;
}
.app {
  width: 400px;
  background: #020617;
  padding: 20px;
  border-radius: 16px;
}
.display {
  height: 60px;
  background: #020617;
  color: #22c55e;
  font-size: 26px;
  text-align: right;
  padding: 10px;
  border-radius: 10px;
  pointer-events: none;
}
.buttons {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;
  margin-top: 10px;
}
button {
  height: 48px;
  border: none;
  border-radius: 12px;
  font-size: 15px;
  cursor: pointer;
  background: #1e293b;
  color: #e5e7eb;
}
.operator { background: #2563eb; }
.equal { background: #22c55e; color: #020617; grid-column: span 2; }
.danger { background: #dc2626; }
select {
  width: 100%;
  padding: 8px;
  border-radius: 8px;
  margin-top: 10px;
}
.section {
  margin-top: 15px;
  border-top: 1px solid #334155;
  padding-top: 10px;
}
.index-list div {
  display: flex;
  justify-content: space-between;
  padding: 6px;
  border-radius: 6px;
  margin-top: 4px;
  font-size: 14px;
  align-items: center;
}
.up { background: #08332a; color: #bbf7d0; }
.down { background: #3f0b0b; color: #fecaca; }
.same { background: #0f172a; color: #cbd5e1; }
.small { font-size: 12px; color: #9ca3af; margin-top: 6px; }
.row-left { display:flex; gap:8px; align-items:center; }
.rate { font-weight:600; margin-left: 8px; }
.delta { font-size: 12px; opacity: 0.9; margin-left: 8px; }
.error-box { background: #dc2626; color: white; padding:8px; border-radius:6px; margin-top:8px; }
</style>
</head>
<body>
<div class="app">
  <div id="display" class="display">0</div>
  <!-- Kalkulator -->
  <div class="buttons">
    <button class="danger" onclick="clearAll()">C</button>
    <button onclick="del()">‚å´</button>
    <button onclick="append('%')">%</button>
    <button class="operator" onclick="append('/')">√∑</button>
    <button onclick="append('7')">7</button>
    <button onclick="append('8')">8</button>
    <button onclick="append('9')">9</button>
    <button class="operator" onclick="append('*')">√ó</button>
    <button onclick="append('4')">4</button>
    <button onclick="append('5')">5</button>
    <button onclick="append('6')">6</button>
    <button class="operator" onclick="append('-')">‚àí</button>
    <button onclick="append('1')">1</button>
    <button onclick="append('2')">2</button>
    <button onclick="append('3')">3</button>
    <button class="operator" onclick="append('+')">+</button>
    <button onclick="append('0')">0</button>
    <button onclick="append('.')">.</button>
    <button class="equal" onclick="calculate()">=</button>
  </div>

  <!-- Konversi -->
  <div class="section">
    <select id="currencySelect"></select>
    <button onclick="convert()">Convert IDR</button>
    <div id="convertHint" class="small">Masukkan jumlah IDR pada layar lalu pilih mata uang dan tekan Convert</div>
  </div>

  <!-- World Index -->
  <div class="section">
    <b>üåç World Currency Index (Base IDR)</b>
    <div id="index" class="index-list"></div>
    <div id="updateInfo" class="small"></div>
    <div id="errorBox" class="error-box" style="display:none;"></div>
  </div>
</div>

<script>
/* ================= CONFIG ================= */
const API_KEY = "7bf955733d797e7f6e318c49";
const BASE = "IDR";
const CURRENCIES = ["USD","EUR","JPY","GBP","AUD","CAD","CHF","CNY","SGD","MYR"];

/* ================= STATE ================= */
let expression = "";
let rates = {};
let previousRates = JSON.parse(localStorage.getItem("previousRates")) || null;
let lastUpdate = localStorage.getItem("lastUpdate") || null;

/* ================= ELEMENTS ================= */
const display = document.getElementById("display");
const indexBox = document.getElementById("index");
const currencySelect = document.getElementById("currencySelect");
const updateInfo = document.getElementById("updateInfo");
const errorBox = document.getElementById("errorBox");

/* ================= KALKULATOR ================= */
function append(v){
  if(display.innerText === "0" && v !== ".") expression = "";
  expression += v;
  display.innerText = expression;
}
function del(){
  expression = expression.slice(0,-1);
  display.innerText = expression || "0";
}
function calculate(){
  try{
    const expr = expression.replace(/%/g, '/100');
    expression = eval(expr).toString();
    display.innerText = expression;
  }catch(e){
    display.innerText = "Error";
    expression = "";
  }
}
function clearAll(){
  expression = "";
  display.innerText = "0";
}

/* ================= API ================= */
async function fetchRates(){
  errorBox.style.display = "none";
  try{
    const res = await fetch(`https://v6.exchangerate-api.com/v6/${API_KEY}/latest/${BASE}`);
    // Jika fetch berhasil, tapi response status bukan 200, kita tetap baca JSON
    const data = await res.json().catch(()=>null);

    if(!res.ok){
      const msg = data && data['error-type'] ? data['error-type'] : `HTTP ${res.status}`;
      showError(`API HTTP Error: ${msg}`);
      return;
    }

    if(!data || data.result !== "success"){
      const msg = data && data['error-type'] ? data['error-type'] : 'Unknown API error';
      showError(`API Error: ${msg}`);
      return;
    }

    // Jika update waktu dari API berbeda -> simpan previous snapshot
    if(lastUpdate !== data.time_last_update_utc){
      previousRates = (rates && Object.keys(rates).length) ? rates : previousRates;
      rates = data.conversion_rates || {};
      localStorage.setItem("previousRates", JSON.stringify(previousRates));
      localStorage.setItem("lastUpdate", data.time_last_update_utc);
      lastUpdate = data.time_last_update_utc;
      updateIndex();
    } else {
      rates = data.conversion_rates || rates;
    }

    updateSelect();
    renderUpdateInfo();
  }catch(err){
    console.error('Fetch error', err);
    // kemungkinan network error atau CORS blocked
    showError(`Gagal mengambil data: ${err.message || err}`);
  }
}

function showError(msg){
  errorBox.style.display = "block";
  errorBox.innerText = msg;
  indexBox.innerHTML = `<div class="down">Gagal mengambil data</div>`;
}

/* ================= INDEX ================= */
function updateIndex(){
  indexBox.innerHTML = "";
  CURRENCIES.forEach(cur=>{
    const now = rates[cur];
    const prev = previousRates ? previousRates[cur] : null;
    let cls = "same";
    let icon = "‚ûñ";
    let deltaText = "";
    if(prev !== null && prev !== undefined && now !== undefined){
      const diff = now - prev;
      const pct = prev ? (diff / prev) * 100 : 0;
      if(diff > 0){ cls = "up"; icon = "üìà"; }
      else if(diff < 0){ cls = "down"; icon = "üìâ"; }
      deltaText = `${diff >= 0 ? '+' : ''}${diff.toFixed(6)} (${pct >= 0 ? '+' : ''}${pct.toFixed(3)}%)`;
    }
    const row = document.createElement("div");
    row.className = cls;
    row.innerHTML = `
      <div class="row-left">
        <span>${cur}</span>
        <span class="rate">${now !== undefined ? now.toFixed(6) : '‚Äî'}</span>
      </div>
      <div>
        <span class="delta">${deltaText}</span>
        <span style="margin-left:8px">${icon}</span>
      </div>
    `;
    indexBox.appendChild(row);
  });
  const info = document.createElement("div");
  info.className = "same";
  info.style.marginTop = "8px";
  info.style.padding = "6px";
  info.innerText = "Update harian (API Free) ‚Äî perubahan diambil dari data terakhir API";
  indexBox.appendChild(info);
}

/* ================= SELECT ================= */
function updateSelect(){
  if(currencySelect.children.length) return;
  CURRENCIES.forEach(c=>{
    const o = document.createElement("option");
    o.value = c;
    o.textContent = c;
    currencySelect.appendChild(o);
  });
}

/* ================= CONVERT ================= */
function convert(){
  const idr = parseFloat(display.innerText);
  if(isNaN(idr)){
    display.innerText = "Masukkan angka";
    setTimeout(()=>{ display.innerText = "0"; expression = ""; }, 1200);
    return;
  }
  const cur = currencySelect.value;
  if(!rates || !rates[cur]){
    display.innerText = "Rates belum siap";
    return;
  }
  const result = (idr * rates[cur]);
  display.innerText = result.toFixed(6) + " " + cur;
  expression = "";
}

/* ================= INFO ================= */
function renderUpdateInfo(){
  if(lastUpdate){
    updateInfo.innerText = `Last API update (UTC): ${lastUpdate} ‚Äî data dari ExchangeRate-API`;
  } else {
    updateInfo.innerText = `Belum ada update API`;
  }
}

/* ================= START ================= */
fetchRates();
// Interval default: 1 menit (ubah jika perlu). Perlu diingat API free biasanya update per jam.
const INTERVAL_MS = 60000;
setInterval(fetchRates, INTERVAL_MS);
</script>
</body>
</html>}

.section {
  margin-top: 15px;
  border-top: 1px solid #334155;
  padding-top: 10px;
}

.index-list div {
  display: flex;
  justify-content: space-between;
  padding: 6px;
  border-radius: 6px;
  margin-top: 4px;
  font-size: 14px;
}

.up { background: #16a34a; }
.down { background: #dc2626; }
.same { background: #475569; }
</style>
</head>

<body>

<div class="app">
  <div id="display" class="display">0</div>

  <!-- Kalkulator -->
  <div class="buttons">
    <button class="danger" onclick="clearAll()">C</button>
    <button onclick="del()">‚å´</button>
    <button onclick="append('%')">%</button>
    <button class="operator" onclick="append('/')">√∑</button>

    <button onclick="append('7')">7</button>
    <button onclick="append('8')">8</button>
    <button onclick="append('9')">9</button>
    <button class="operator" onclick="append('*')">√ó</button>

    <button onclick="append('4')">4</button>
    <button onclick="append('5')">5</button>
    <button onclick="append('6')">6</button>
    <button class="operator" onclick="append('-')">‚àí</button>

    <button onclick="append('1')">1</button>
    <button onclick="append('2')">2</button>
    <button onclick="append('3')">3</button>
    <button class="operator" onclick="append('+')">+</button>

    <button onclick="append('0')">0</button>
    <button onclick="append('.')">.</button>
    <button class="equal" onclick="calculate()">=</button>
  </div>

  <!-- Konversi -->
  <div class="section">
    <select id="currencySelect"></select>
    <button onclick="convert()">Convert IDR</button>
  </div>

  <!-- World Index -->
  <div class="section">
    <b>üåç World Currency Index (Base IDR)</b>
    <div id="index" class="index-list"></div>
  </div>
</div>

<      }else if(now < prev){
        cls = "down";
        icon = "üìâ";
      }
    }

    const row = document.createElement("div");
    row.className = cls;
    row.innerHTML = `<span>${cur}</span><span>${icon}</span>`;
    indexBox.appendChild(row);
  });
}

<script>
/* ================= CONFIG ================= */
const API_KEY = "7bf955733d797e7f6e318c49";
const BASE = "IDR";
const CURRENCIES = ["USD","EUR","JPY","GBP","AUD","CAD","CHF","CNY","SGD","MYR"];

/* ================= STATE ================= */
let expression = "";
let rates = {};
let previousRates = JSON.parse(localStorage.getItem("previousRates")) || null;
let lastUpdate = localStorage.getItem("lastUpdate");

/* ================= ELEMENT ================= */
const display = document.getElementById("display");
const indexBox = document.getElementById("index");
const currencySelect = document.getElementById("currencySelect");

/* ================= KALKULATOR ================= */
function append(v){
  if(display.innerText === "0") expression = "";
  expression += v;
  display.innerText = expression;
}
function del(){
  expression = expression.slice(0,-1);
  display.innerText = expression || "0";
}
function calculate(){
  try{
    expression = eval(expression).toString();
    display.innerText = expression;
  }catch{
    display.innerText = "Error";
    expression = "";
  }
}
function clearAll(){
  expression = "";
  display.innerText = "0";
  indexBox.innerHTML = "";
}

/* ================= API ================= */
async function fetchRates(){
  try{
    const res = await fetch(
      `https://v6.exchangerate-api.com/v6/${API_KEY}/latest/${BASE}`
    );
    const data = await res.json();

    if(data.result !== "success"){
      indexBox.innerHTML = `<div class="down">API Error</div>`;
      return;
    }

    // Jika update API baru
    if(lastUpdate !== data.time_last_update_utc){
      previousRates = rates;
      rates = data.conversion_rates;

      localStorage.setItem("previousRates", JSON.stringify(previousRates));
      localStorage.setItem("lastUpdate", data.time_last_update_utc);

      updateIndex();
    }

    updateSelect();
  }catch{
    indexBox.innerHTML = `<div class="down">Gagal mengambil data</div>`;
  }
}

/* ================= INDEX ================= */
function updateIndex(){
  indexBox.innerHTML = "";

  CURRENCIES.forEach(cur=>{
    const now = rates[cur];
    const prev = previousRates ? previousRates[cur] : null;

    let cls = "same";
    let icon = "‚ûñ";

    if(prev !== null){
      if(now > prev){ cls = "up"; icon = "üìà"; }
      else if(now < prev){ cls = "down"; icon = "üìâ"; }
    }

    const row = document.createElement("div");
    row.className = cls;
    row.innerHTML = `<span>${cur}</span><span>${icon}</span>`;
    indexBox.appendChild(row);
  });

  const info = document.createElement("div");
  info.className = "same";
  info.innerText = "Update harian (API Free)";
  indexBox.appendChild(info);
}

/* ================= SELECT ================= */
function updateIndex(){
  indexBox.innerHTML = "";

  if(!rates || Object.keys(rates).length === 0){
    indexBox.innerHTML = `<div class="same">Loading data kurs...</div>`;
    return;
  }

  CURRENCIES.forEach(cur=>{
    const now = rates[cur];
    const prev = previousRates ? previousRates[cur] : null;

    let cls = "same";
    let changeText = "0.00%";

    if(prev){
      const diff = ((now - prev) / prev) * 100;
      changeText = diff.toFixed(2) + "%";

      if(diff > 0) cls = "up";
      else if(diff < 0) cls = "down";
    }

    const row = document.createElement("div");
    row.className = cls;
    row.innerHTML = `
      <span>${cur}</span>
      <span>${now.toFixed(6)}</span>
      <span>${changeText}</span>
    `;
    indexBox.appendChild(row);
  });

  const info = document.createElement("div");
  info.className = "same";
  info.innerText = "Data harian (ExchangeRate API Free)";
  indexBox.appendChild(info);
}

/* ================= CONVERT ================= */
function convert(){
  const idr = parseFloat(display.innerText);
  if(isNaN(idr)) return;
  const cur = currencySelect.value;
  display.innerText = (idr * rates[cur]).toFixed(4) + " " + cur;
  expression = "";
}

/* ================= START ================= */
fetchRates();
// cukup 1x per jam, bukan per menit
setInterval(fetchRates, 3600000);
</script>

</body>
</html>
